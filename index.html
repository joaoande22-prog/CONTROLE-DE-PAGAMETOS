<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FamÃ­lia FÃªnix â€“ CobranÃ§as</title>
<style>
body{font-family:Arial;background:#0f0f0f;color:#fff;padding:20px}
h2{color:#ffcc00;text-align:center}
input,button{padding:12px;margin:5px 0;border-radius:8px;border:none;font-size:15px;width:100%}
input{background:#222;color:#fff}
button{font-weight:bold;cursor:pointer}
#salvar{background:#ff5722}
#enviarTodos{background:#25d366;margin:5px 0}
#exportar{background:#2196f3;margin:5px 0}
#importarArquivo{background:#ff9800;margin:5px 0}
.card{background:#1c1c1c;padding:12px;border-radius:10px;margin-bottom:10px;font-size:14px}
.card b{font-size:18px;} 
.actions{display:flex;gap:4px;margin-top:8px;flex-wrap:wrap}
.actions button{padding:6px;font-size:13px;border-radius:6px}
.whats{background:#25d366}.pago{background:#ff9800}.editar{background:#9c27b0}.excluir{background:#f44336}
.horarios{display:flex;gap:8px;margin:10px 0}
.horarios button{flex:1;background:#222;color:#fff}
.horarios button.ativo{background:#ffcc00;color:#000}
#contador{margin:5px 0;color:#ffcc00;font-weight:bold}

/* Abas lado a lado */
.tabs-container { display:flex; gap:10px; margin-top:15px; }
.tab { flex:1; background:#111; padding:10px; border-radius:8px; max-height:500px; overflow-y:auto; }
.tab h3{color:#ffcc00;margin-bottom:5px;}
</style>
</head>
<body>

<h2>ğŸ”¥ FamÃ­lia FÃªnix â€“ CobranÃ§as</h2>

<input id="nome" placeholder="Nome do aluno">
<input id="telefone" placeholder="Telefone com DDD">

<div class="horarios">
  <button class="ativo" data-horario="7:00">7:00</button>
  <button data-horario="8:00">8:00</button>
  <button data-horario="Feminino">Mulheres</button>
  <button data-horario="Kids">CrianÃ§as</button>
</div>

<div id="contador"></div>

<button id="salvar">ğŸ’¾ Salvar</button>
<button id="enviarTodos">ğŸ“¤ Enviar para todos</button>
<button id="exportar">ğŸ’¾ Exportar CSV</button>
<input type="file" id="importarArquivo" accept=".txt,.csv">
<input id="busca" placeholder="ğŸ” Buscar aluno">

<!-- ABAS LADO A LADO -->
<div class="tabs-container">
  <div class="tab">
    <h3>Aguardando Pagamento</h3>
    <div id="listaA"></div>
  </div>

  <div class="tab">
    <h3>Pagos</h3>
    <div id="listaP"></div>
    <button id="resetPagos">ğŸ”„ Resetar todos pagos</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const PIX = "+55 75 98235-2788";
let editId = null;
let filtroHorario = "7:00";

const get = () => JSON.parse(localStorage.getItem("alunos") || "[]");
const set = a => localStorage.setItem("alunos", JSON.stringify(a));

const atualizarContador = () => {
  const totalA = get().filter(a=>a.horario===filtroHorario && !a.pago && a.nome.toLowerCase().includes(busca.value.toLowerCase())).length;
  const totalP = get().filter(a=>a.horario===filtroHorario && a.pago && a.nome.toLowerCase().includes(busca.value.toLowerCase())).length;
  document.getElementById('contador').innerText = `Aguardando: ${totalA} | Pagos: ${totalP}`;
}

const render = () => {
  const alunos = get();
  const listaA = document.getElementById('listaA');
  const listaP = document.getElementById('listaP');
  listaA.innerHTML = "";
  listaP.innerHTML = "";

  alunos.filter(a=>a.horario===filtroHorario && a.nome.toLowerCase().includes(busca.value.toLowerCase()) && !a.pago)
    .forEach(a=>{
      const d=document.createElement("div"); d.className="card";
      d.innerHTML=`<b>${a.nome}</b><br>${a.telefone}
        <div class="actions">
          <button class="whats" onclick="enviar('${a.nome}','${a.telefone}')">ğŸ’¬</button>
          <button class="pago" onclick="pagar(${a.id})">âœ…</button>
          <button class="editar" onclick="editar(${a.id})">âœï¸</button>
          <button class="excluir" onclick="excluir(${a.id})">ğŸ—‘</button>
        </div>`;
      listaA.appendChild(d);
    });

  alunos.filter(a=>a.horario===filtroHorario && a.pago && a.nome.toLowerCase().includes(busca.value.toLowerCase()))
    .forEach(a=>{
      const d=document.createElement("div"); d.className="card";
      d.innerHTML=`<b>${a.nome}</b><br>${a.telefone}
        <div class="actions">
          <button class="editar" onclick="editar(${a.id})">âœï¸</button>
          <button class="excluir" onclick="excluir(${a.id})">ğŸ—‘</button>
        </div>`;
      listaP.appendChild(d);
    });

  atualizarContador();
};

// Mudar horÃ¡rio
document.querySelectorAll('.horarios button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    filtroHorario = btn.dataset.horario;
    document.querySelectorAll('.horarios button').forEach(b=>b.classList.remove('ativo'));
    btn.classList.add('ativo');
    render();
  });
});

// Salvar aluno
document.getElementById('salvar').onclick = ()=>{
  if(!nome.value || !telefone.value) return alert("Preencha tudo");
  const alunos = get();
  if(editId){
    alunos.forEach(a=>{if(a.id===editId){a.nome=nome.value;a.telefone=telefone.value;a.horario=filtroHorario;}});
    editId=null;
  } else {
    alunos.push({id:Date.now()+Math.random(), nome:nome.value, telefone:telefone.value, horario:filtroHorario, pago:false});
  }
  set(alunos); nome.value=""; telefone.value="";
  render();
};

// AÃ§Ãµes
window.editar=id=>{ const a=get().find(x=>x.id===id); nome.value=a.nome; telefone.value=a.telefone; filtroHorario=a.horario; editId=id; render(); };
window.excluir=id=>{ if(confirm("Deseja realmente excluir este aluno?")){ set(get().filter(a=>a.id!==id)); render(); } };
window.pagar=id=>{ set(get().map(a=>a.id===id?{...a,pago:true}:a)); render(); };
window.enviar=(nome,telefone)=>{ const numero=telefone.replace(/\D/g,""); const msg=`OlÃ¡ ${nome}! ğŸ¥Š\nAqui Ã© da *FamÃ­lia FÃªnix* ğŸ”¥\nPassando para lembrar sobre a mensalidade do mÃªs.\nğŸ’³ PIX: ${PIX}\nAgradecemos desde jÃ¡.`; window.open(`https://wa.me/55${numero}?text=${encodeURIComponent(msg)}`,"_blank"); };

// Enviar todos
document.getElementById('enviarTodos').onclick = ()=>{
  const pend=get().filter(a=>!a.pago && a.horario===filtroHorario);
  if(!pend.length) return alert("Nenhum pendente nesse horÃ¡rio");
  if(!confirm(`Enviar para ${pend.length} alunos?`)) return;
  pend.forEach((a,i)=>setTimeout(()=>enviar(a.nome,a.telefone),i*1500));
};

// Resetar pagos
document.getElementById('resetPagos').onclick = ()=>{
  if(confirm("Deseja mover todos os pagos para aguardando pagamento?")){
    set(get().map(a=>({...a,pago:false}))); render();
  }
};

// Exportar CSV
document.getElementById('exportar').onclick = ()=>{
  const filtrados = get().filter(a=>a.horario===filtroHorario && a.nome.toLowerCase().includes(busca.value.toLowerCase()));
  if(!filtrados.length) return alert("Nenhum aluno para exportar!");
  let csv="Nome,Telefone,HorÃ¡rio,Pago\n";
  filtrados.forEach(a=>csv+=`${a.nome},${a.telefone},${a.horario},${a.pago}\n`);
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const link=document.createElement("a"); link.href=url; link.download="alunos.csv"; link.click();
  URL.revokeObjectURL(url);
};

// Importar TXT/CSV
document.getElementById('importarArquivo').addEventListener('change', e=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=evt=>{
    const lines=evt.target.result.split("\n");
    const alunos=get();
    lines.forEach(l=>{
      if(!l.trim()) return;
      let nome="",telefone="";
      if(l.includes("â€”")){ [nome,telefone]=l.split("â€”"); } 
      else{ [telefone,nome]=l.split("-"); }
      if(!nome||!telefone) return;
      nome=nome.trim(); telefone=telefone.trim();
      if(!alunos.some(a=>a.telefone===telefone)) alunos.push({id:Date.now()+Math.random(), nome, telefone, horario:filtroHorario, pago:false});
    });
    set(alunos); render(); alert("ImportaÃ§Ã£o concluÃ­da!");
  };
  reader.readAsText(file);
});

render();
});
</script>

</body>
</html>
