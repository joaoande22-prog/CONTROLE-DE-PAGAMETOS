<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kickboxing Cobran√ßa</title>

<style>
body{font-family:Arial;background:#0f0f0f;color:#fff;padding:20px}
h2{color:#ffcc00;text-align:center}

input,button{
  width:100%;padding:12px;margin:5px 0;
  border-radius:8px;border:none;font-size:15px
}
input{background:#222;color:#fff}
button{font-weight:bold;cursor:pointer}

#salvar{background:#ff5722}
#enviarTodos{background:#25d366;margin:15px 0}

.card{
  background:#1c1c1c;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  font-size:14px;
}

.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  margin-top:8px;
}
.actions button{
  padding:8px;
  font-size:13px;
  border-radius:6px;
}

.whats{background:#25d366}
.pago{background:#ff9800}
.editar{background:#9c27b0}
.excluir{background:#f44336}

.horarios{
  display:flex;
  gap:8px;
  margin:10px 0;
}
.horarios button{
  flex:1;
  background:#222;
  color:#fff;
}
.horarios button.ativo{
  background:#ffcc00;
  color:#000;
}
</style>
</head>

<body>

<h2>ü•ä Kickboxing Cobran√ßa</h2>

<input id="nome" placeholder="Nome do aluno">
<input id="telefone" placeholder="Telefone com DDD">

<div class="horarios">
  <button class="ativo" onclick="setHorario('7:00',this)">7:00</button>
  <button onclick="setHorario('8:00',this)">8:00</button>
  <button onclick="setHorario('Feminino',this)">Mulheres</button>
  <button onclick="setHorario('Kids',this)">Crian√ßas</button>
</div>

<input type="hidden" id="horario" value="7:00">

<button id="salvar">üíæ Salvar</button>

<input id="busca" placeholder="üîç Buscar aluno">

<button id="enviarTodos">üì§ ENVIAR PARA TODOS OS PENDENTES</button>

<div id="lista"></div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const PIX = "+55 75 98235-2788";
let editId = null;
let filtroHorario = "7:00";

const get = () => JSON.parse(localStorage.getItem("alunos") || "[]");
const set = a => localStorage.setItem("alunos", JSON.stringify(a));

window.setHorario = (v, btn) => {
  horario.value = v;
  filtroHorario = v;
  document.querySelectorAll(".horarios button")
    .forEach(b => b.classList.remove("ativo"));
  btn.classList.add("ativo");
  render(busca.value);
};

salvar.onclick = () => {
  if(!nome.value || !telefone.value)
    return alert("Preencha tudo");

  const alunos = get();

  if(editId){
    alunos.forEach(a=>{
      if(a.id === editId){
        a.nome = nome.value;
        a.telefone = telefone.value;
        a.horario = horario.value;
      }
    });
    editId = null;
  } else {
    alunos.push({
      id: Date.now(),
      nome: nome.value,
      telefone: telefone.value,
      horario: horario.value,
      pago: false
    });
  }

  set(alunos);
  nome.value = "";
  telefone.value = "";
  horario.value = filtroHorario;
  render(busca.value);
};

function render(f=""){
  lista.innerHTML="";
  get()
    .filter(a =>
      a.horario === filtroHorario &&
      a.nome.toLowerCase().includes(f.toLowerCase())
    )
    .forEach(a=>{
      const d = document.createElement("div");
      d.className = "card";
      d.innerHTML = `
        <b>${a.nome}</b><br>
        ${a.telefone} | ${a.horario}
        <div class="actions">
          ${!a.pago ? `
            <button class="whats" onclick="enviar('${a.nome}','${a.telefone}')">üí¨ Enviar</button>
            <button class="pago" onclick="pagar(${a.id})">‚úÖ Pago</button>
          ` : ""}
          <button class="editar" onclick="editar(${a.id})">‚úèÔ∏è Editar</button>
          <button class="excluir" onclick="excluir(${a.id})">üóë Excluir</button>
        </div>
      `;
      lista.appendChild(d);
    });
}

busca.oninput = e => render(e.target.value);

window.editar = id => {
  const a = get().find(x=>x.id===id);
  nome.value = a.nome;
  telefone.value = a.telefone;
  horario.value = a.horario;
  filtroHorario = a.horario;
  editId = id;

  document.querySelectorAll(".horarios button")
    .forEach(b=>{
      b.classList.toggle("ativo",
        b.textContent === a.horario ||
        (b.textContent==="Mulheres" && a.horario==="Feminino") ||
        (b.textContent==="Crian√ßas" && a.horario==="Kids")
      );
    });

  render(busca.value);
};

window.excluir = id => {
  set(get().filter(a=>a.id!==id));
  render(busca.value);
};

window.pagar = id => {
  set(get().map(a=>a.id===id?{...a,pago:true}:a));
  render(busca.value);
};

/* ‚úÖ WHATSAPP WEB */
window.enviar = (nome, telefone) => {
  const numero = telefone.replace(/\D/g,"");
  const msg = `Ol√° ${nome}! ü•ä

√öltimo dia para pagamento da mensalidade.

üí≥ PIX: ${PIX}`;

  const url = `https://wa.me/55${numero}?text=${encodeURIComponent(msg)}`;
  window.open(url, "_blank");
};

enviarTodos.onclick = () => {
  const pend = get().filter(a=>!a.pago && a.horario===filtroHorario);
  if(!pend.length) return alert("Nenhum pendente nesse hor√°rio");
  if(!confirm(`Enviar para ${pend.length} alunos?`)) return;
  pend.forEach((a,i)=>setTimeout(()=>enviar(a.nome,a.telefone),i*1500));
};

render();
});
</script>

</body>
</html>
