<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kickboxing Cobrança - WhatsApp</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif;}
body{background:linear-gradient(135deg,#000,#1a1a1a);color:#f1f1f1;padding:20px;}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;text-align:center;}
header img{width:70px;height:auto;border-radius:10px;}
header h1{color:#ffcc00;font-size:18px;margin-top:10px;}
h2{text-align:center;color:#ffcc00;margin-bottom:15px;}
input,select,button{padding:12px;margin:5px 0;border-radius:10px;border:none;font-size:16px;width:100%;}
input,select{background:#222;color:#fff;}
input::placeholder,select{color:#aaa;}
button{cursor:pointer;transition:0.3s;font-weight:bold;}
#btnSalvar{background:#ff5722;color:#fff;}
#btnEnviar{background:#25d366;color:#fff;margin-bottom:10px;}
button:hover{opacity:0.85;}
#formCadastro{display:flex;flex-direction:column;gap:8px;margin-bottom:20px;}
#buscaAluno{width:100%;margin:15px 0;}
#listasHorarios{display:flex;flex-direction:column;gap:20px;}
.section{flex:1;background:#111;padding:10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.6);}
ul{list-style:none;padding:0;}
li{margin:5px 0;padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:5px;background:#222;box-shadow:0 2px 6px rgba(0,0,0,0.6);}
li span{font-size:15px;font-weight:500;}
.actions{display:flex;flex-wrap:wrap;gap:6px;}
.actions button{flex:1;padding:8px;border-radius:8px;font-size:14px;font-weight:bold;color:#fff;min-width:80px;}
.actions button.whatsapp{background:#25d366;}
.actions button.pago{background:#ff9800;}
.actions button.copiar{background:#2196f3;}
.actions button.excluir{background:#f44336;}
.actions button.editar{background:#9c27b0;}
#resumoFinanceiro{font-weight:bold;margin-bottom:15px;text-align:center;}
h3{color:#ffcc00;margin-bottom:10px;text-align:center;}
h4{margin:6px 0;color:#fff;text-align:center;font-size:14px;}
@media(min-width:700px){
  body{padding:40px;}
  #formCadastro{flex-direction:row;flex-wrap:wrap;align-items:flex-start;}
  input,select,button{width:auto;flex:1;min-width:140px;}
  #btnSalvar,#btnEnviar{width:auto;}
  #listasHorarios{flex-direction:row;}
  .section{padding:15px;}
}
</style>
</head>
<body>

<header>
  <img src="Imagem do WhatsApp de 2025-10-27 à(s) 08.55.56_18b7c426.jpg" alt="Logo Kickboxing">
  <h1 id="dataHoje"></h1>
</header>

<h2>🔥 Kickboxing Cobrança</h2>

<div id="formCadastro">
  <input type="text" id="nome" placeholder="Nome do aluno">
  <input type="text" id="telefone" placeholder="Telefone (somente números)">
  <input type="number" id="valor" placeholder="Valor da mensalidade">
  <select id="horario">
    <option value="7">7:00</option>
    <option value="8">8:00</option>
  </select>
  <button id="btnSalvar">💾 Salvar ou editar aluno</button>
  <button id="btnEnviar">💬 Enviar mensagem individual</button>
</div>

<input type="text" id="buscaAluno" placeholder="🔍 Buscar aluno...">
<div id="resumoFinanceiro">🔴 Pendentes: R$0.00 | 🟢 Pagos: R$0.00</div>

<div id="listasHorarios">
  <div class="section">
    <h3>🕖 PRIMEIRO Horário :7:00</h3>
    <h4>🔴 PENDENTES</h4>
    <ul id="listaPendentes7"></ul>
    <h4>🟢 PAGOS</h4>
    <ul id="listaPagos7"></ul>
  </div>
  <div class="section">
    <h3>🕗 SEGUNDO Horário :8:00</h3>
    <h4>🔴 PENDENTES</h4>
    <ul id="listaPendentes8"></ul>
    <h4>🟢 PAGOS</h4>
    <ul id="listaPagos8"></ul>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, ref, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9FbKvDEBLI2XfZuGvXhdZAqKPj3E4SJk",
  authDomain: "controle-de-pagamentos-13d40.firebaseapp.com",
  projectId: "controle-de-pagamentos-13d40",
  storageBucket: "controle-de-pagamentos-13d40.appspot.com",
  messagingSenderId: "150820329975",
  appId: "1:150820329975:web:39d40fbb3fdb953b54b6f2",
  measurementId: "G-S8KV4MDW48"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// === DATA ===
function atualizarCabecalhoData(){
  const hoje = new Date();
  const op = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  document.getElementById("dataHoje").innerText = hoje.toLocaleDateString('pt-BR', op);
}

// === WHATSAPP ===
function enviarWhatsApp(nome, telefone, valor){
  const mensagem = `Oi ${nome}! 🥊 Sua mensalidade de R$${valor.toFixed(2)} está te esperando! Bora treinar? 😃 — Equipe Kickboxing 🔥`;
  const numero = telefone.replace(/\D/g,'');
  window.open(`https://api.whatsapp.com/send?phone=55${numero}&text=${encodeURIComponent(mensagem)}`,'_blank');
}

// === FUNÇÕES FIREBASE ===
function setAlunoFirebase(aluno){
  const id = aluno.id || Date.now() + Math.floor(Math.random()*1000);
  set(ref(db, 'alunos/' + id), {...aluno, id});
}

function excluirAlunoFirebase(id){
  remove(ref(db, 'alunos/' + id));
}

function marcarPagoFirebase(id){
  update(ref(db, 'alunos/' + id), {pago:true, data:new Date().toISOString()});
}

function getAlunosFirebase(callback){
  const alunosRef = ref(db, 'alunos');
  onValue(alunosRef, (snapshot) => {
    const data = snapshot.val();
    callback(data ? Object.values(data) : []);
  });
}

// === CARREGAR LISTAS ===
function carregarListasOnline(filtro=""){
  getAlunosFirebase(alunos=>{
    const pendentes7 = alunos.filter(a=>!a.pago && a.horario==='7' && a.nome.toLowerCase().includes(filtro.toLowerCase()));
    const pagos7 = alunos.filter(a=>a.pago && a.horario==='7' && a.nome.toLowerCase().includes(filtro.toLowerCase()));
    const pendentes8 = alunos.filter(a=>!a.pago && a.horario==='8' && a.nome.toLowerCase().includes(filtro.toLowerCase()));
    const pagos8 = alunos.filter(a=>a.pago && a.horario==='8' && a.nome.toLowerCase().includes(filtro.toLowerCase()));

    function preencherLista(lista, alunos){
      lista.innerHTML="";
      alunos.forEach(a=>{
        const li = document.createElement("li");
        li.innerHTML = `<span>${a.nome} - ${a.telefone} - R$${(a.valor||0).toFixed(2)} | Última: ${new Date(a.data).toLocaleDateString()}</span>
        <div class="actions">
          ${!a.pago?`<button class="whatsapp" onclick="enviarWhatsApp('${a.nome}','${a.telefone}',${a.valor||0})">💬 Enviar mensagem</button>
          <button class="pago" onclick="marcarPagoFirebase(${a.id})">✅ Marcar como pago</button>`:""}
          <button class="editar" onclick="editarAluno(${a.id})">✏️ Editar</button>
          <button class="excluir" onclick="excluirAlunoFirebase(${a.id})">🗑 Excluir</button>
        </div>`;
        lista.appendChild(li);
      });
    }

    preencherLista(document.getElementById("listaPendentes7"), pendentes7);
    preencherLista(document.getElementById("listaPagos7"), pagos7);
    preencherLista(document.getElementById("listaPendentes8"), pendentes8);
    preencherLista(document.getElementById("listaPagos8"), pagos8);

    const totalPendentes = alunos.filter(a=>!a.pago).reduce((acc,a)=>acc+(a.valor||0),0);
    const totalPagos = alunos.filter(a=>a.pago).reduce((acc,a)=>acc+(a.valor||0),0);
    document.getElementById("resumoFinanceiro").innerText = `🔴 Pendentes: R$${totalPendentes.toFixed(2)} | 🟢 Pagos: R$${totalPagos.toFixed(2)}`;
  });
}

// === EDITAR ===
let editandoId = null;
function editarAluno(id){
  getAlunosFirebase(alunos=>{
    const aluno = alunos.find(a=>a.id===id);
    if(!aluno) return;
    document.getElementById("nome").value = aluno.nome;
    document.getElementById("telefone").value = aluno.telefone;
    document.getElementById("valor").value = aluno.valor||"";
    document.getElementById("horario").value = aluno.horario;
    editandoId = id;
  });
}

// === ADICIONAR CONTATOS INICIAIS ===
const contatos = [
  "Gustavo - 7583009378","LUAN , MADERADA - 75982819958","Dandan Auto Elétrica - 7181192057",
  "Rogerio jordan - 7182454233","Theus Senna😼CARATECA - 7193063739","Kay Luz - 7581002782",
  "Márcia Laiane ✨ - 7581119429","Tinaairam Airam - 7581142791","Valdir Lima PARUDO - 7581330340",
  "Uilson Martins personal - 7581429991","Josi🔥PAO DE MEL - 7581467974","Linodosarau - 7581508130",
  "Laícia Moreira - 7581711462","Renan - 7581823405","Jaqueline♡ - 7581856226",
  "Carlos Lima - 7581949719","TecSound_assistencia_tecn - 7582084265","Eduardo - 7582453054",
  "Edvania Santos - 7582464789","Gabriel - 7582465947","Igor Miranda - 7582686171",
  "Sinho - 7582915059","Mirele - 7582993778","Dayana 👑 - 7583093078",
  "Ninho - 7583557058","Yanna Novais | Advogada - 7583605100","Ô Marras, CABELIHO - 7588367138",
  "Paredinha_do_gordinho MATHEUS - 7598444619","Nice - 7598847923","♥︎Juliana De Cassia♥︎ - 7599726736"
];

function adicionarContatosIniciais(){
  getAlunosFirebase(alunos=>{
    if(alunos.length === 0){
      contatos.forEach(c=>{
        const [nome,telefone] = c.split("-");
        setAlunoFirebase({
          nome: nome.trim(),
          telefone: telefone.trim().replace(/\D/g,""),
          valor:0,
          pago:false,
          data:new Date().toISOString(),
          horario:"8"
        });
      });
    }
  });
}

// === INICIALIZAÇÃO ===
document.addEventListener("DOMContentLoaded", ()=>{
  atualizarCabecalhoData();
  adicionarContatosIniciais();
  carregarListasOnline();

  document.getElementById("btnSalvar").addEventListener("click", ()=>{
    const nome = document.getElementById("nome").value.trim();
    const telefone = document.getElementById("telefone").value.trim();
    const valor = parseFloat(document.getElementById("valor").value) || 0;
    const horario = document.getElementById("horario").value;
    if(!nome || !telefone){alert("⚠️ Preencha nome e telefone!"); return;}
    setAlunoFirebase({id:editandoId, nome, telefone, valor, pago:false, data:new Date().toISOString(), horario});
    editandoId = null;
    document.getElementById("nome").value="";
    document.getElementById("telefone").value="";
    document.getElementById("valor").value="";
  });

  document.getElementById("btnEnviar").addEventListener("click", ()=>{
    const nome = document.getElementById("nome").value.trim();
    const telefone = document.getElementById("telefone").value.trim();
    const valor = parseFloat(document.getElementById("valor").value) || 0;
    if(!nome || !telefone){alert("⚠️ Preencha nome e telefone!"); return;}
    enviarWhatsApp(nome, telefone, valor);
  });

  document.getElementById("buscaAluno").addEventListener("input",(e)=> carregarListasOnline(e.target.value));
});
</script>
</body>
</html>
